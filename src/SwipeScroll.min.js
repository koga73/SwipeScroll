var SwipeScroll={EVENT_CHANGING:"event_changing",EVENT_CHANGED:"event_changed",DIRECTION_HORIZONTAL:"horizontal",DIRECTION_VERTICAL:"vertical",defaults:{fps:30,timing:.5,dragThreshold:32,overDrag:.25,dragMaxSpeed:1024,dragSpeedFactor:.5,useMomentum:true,useSnap:true,scrollbars:false,scrollEasing:null,cssAnimationClass:null,bidirectional:false},expoEaseOut:function(e,t,n,r){return n*(-Math.pow(2,-10*e/r)+1)+t},NormalTimer:function(){var e={delta:0,lastTime:0,tick:function(){var t=(new Date).getTime();e.delta=(t-e.lastTime)*.001;e.lastTime=t;return e.delta}};return e}};(function(e){e.fn.SwipeScroll=function(t){var n=e.extend({},e.fn.SwipeScroll.defaults,t);var r=false;var i=this;var s=this.parent();var o=null;var u=null;var a=null;var f=null;var l=null;var c=false;var h={};var p={};var d=0;var v=null;var m={};var g={};var y={};var b={};var w={};var E=false;var S=false;var x={};var T=0;var N=null;var C=null;var k=null;var L=null;var A=null;var O=-1;var M=false;var _={initialize:function(){if(!n.scrollEasing){n.scrollEasing=SwipeScroll.expoEaseOut}if(n.cssAnimationClass){var t=["webkitTransition","mozTransition","OTransition","transition"];var r=t.length;for(var i=0;i<r;i++){if(typeof document.documentElement.style[t[i]]!==typeof undefined){break}}if(i==r){n.cssAnimationClass=null}}if(n.scrollbars){_.buildScrollbars()}N=SwipeScroll.NormalTimer();C=SwipeScroll.NormalTimer();_.updateChildren();A=e(o[0]);O=0},destroy:function(){if(u){u.remove();u=null}if(a){a.remove();a=null}if(f){f.remove();f=null}if(l){l.remove();l=null}N=null;C=null;if(k){clearInterval(_.handler_renderTimer);k=null}if(L){clearTimeout(_.handler_resizeTimeout);L=null}o=null;A=null},activate:function(){if(r){return}r=true;s.css({"-webkit-transform":"translate3d(0, 0, 0)","-moz-transform":"translate3d(0, 0, 0)","-o-transform":"translate3d(0, 0, 0)",transform:"translate3d(0, 0, 0)","-webkit-backface-visibility":"hidden","-moz-backface-visibility":"hidden","-o-backface-visibility":"hidden","backface-visibility":"hidden","-ms-touch-action":"none"});s.on("touchstart mousedown",_.handler_beginDrag);var t=e(document);t.on("touchmove mousemove",_.handler_moveDrag);t.on("touchend mouseup",_.handler_endDrag);var n="resize";if("onorientationchange"in window){n="orientationchange"}e(window).on(n,_.handler_resize)},deactivate:function(){if(!r){return}r=false;s.css({"-webkit-transform":"","-moz-transform":"","-o-transform":"",transform:"","-webkit-backface-visibility":"visible","-moz-backface-visibility":"visible","-o-backface-visibility":"visible","backface-visibility":"visible","-ms-touch-action":"auto"});s.off("touchstart mousedown",_.handler_beginDrag);var t=e(document);t.off("touchmove mousemove",_.handler_moveDrag);t.off("touchend mouseup",_.handler_endDrag);var n="resize";if("onorientationchange"in window){n="orientationchange"}e(window).off(n,_.handler_resize)},reset:function(){_.deactivate();_.destroy();_.initialize();_.activate()},scrollToChild:function(e,t){if(!e||!e.jquery){throw new Error("Invalid selectChild must be a jquery object of _element.children().")}if(typeof t===typeof undefined){t=true}if(typeof e.data("SwipeScroll.index")===typeof undefined){_.updateChildren()}var n=_.getChildPoint(e);y.x=-n.x;y.y=-n.y;_.rangeElementPoint();var r=_.getClosestChild(y);var s=_.getChildPoint(r);y.x=-s.x;y.y=-s.y;if(i.is(":hidden")){y.x=0;y.y=0}var o=r.data("SwipeScroll.index");if(o!=O){A=r;O=o;M=true}else{M=false}_.endDrag();_.endTween(true);if(t){_.beginRender();_.beginTween(_.getElementPoint())}else{_.setElementPoint(y);_.fireEventChanged()}},scrollToIndex:function(t){t=Math.max(Math.min(t,o.length-1),0);_.scrollToChild(e(o[t]))},scrollPrevious:function(e,t){if(typeof e===typeof undefined){e=1}if(O==-1){return}_.scrollToIndex(O-e)},scrollNext:function(e,t){if(typeof e===typeof undefined){e=1}if(O==-1){return}_.scrollToIndex(O+e)},updateChildren:function(){o=i.children();var t=o.length;for(var r=0;r<t;r++){e(o[r]).data("SwipeScroll.index",r)}if(n.scrollbars){_.sizeScrollbars()}var s=e("a",i);s.off("click",_.handler_child_click);s.on("click",_.handler_child_click)},handler_child_click:function(){if(S){return false}},buildScrollbars:function(){u=e("<div class='swipescroll-scrollbar-mask swipescroll-scrollbar-h-mask'style='display:none;overflow:hidden;position:absolute;bottom:1px;left:1px;width:100%;height:4px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;'></div>");a=e("<div class='swipescroll-scrollbar swipescroll-scrollbar-h'style='position:absolute;left:0;bottom:0;background-color:rgba(0,0,0,0.6);min-width:4px;height:100%;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;'></div>");u.append(a);s.append(u);f=e("<div class='swipescroll-scrollbar-mask swipescroll-scrollbar-v-mask'style='display:none;overflow:hidden;position:absolute;right:1px;top:1px;width:4px;height:100%;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;'></div>");l=e("<div class='swipescroll-scrollbar swipescroll-scrollbar-v'style='position:absolute;right:0;top:0;background-color:rgba(0,0,0,0.6);width:100%;min-height:4px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;'></div>");f.append(l);s.append(f)},sizeScrollbars:function(){var e=i.width();var t=i.height();var n=s.width();var r=s.height();if(e<=n){u.hide()}else{u.css("width",n-2+"px");u.show();var o=(n/(e/n)>>0)-2;a.css("width",o+"px")}if(t<=r){f.hide()}else{f.css("height",r-2+"px");f.show();var c=(r/(t/r)>>0)-2;l.css("height",c+"px")}_.positionScrollbars()},positionScrollbars:function(){var e=i.width();var t=i.height();var n=s.width();var r=s.height();var o=_.getElementPoint();var c=u.width();var h=a.width();var p=f.height();var d=l.height();var v=(e-(e+o.x))/(e-n);var m=(c-h)*v>>0;var g=(t-(t+o.y))/(t-r);var y=(p-d)*g>>0;m=Math.max(Math.min(m,c-8),-h+8);y=Math.max(Math.min(y,p-8),-d+8);a.css("left",m+"px");l.css("top",y+"px")},handler_beginDrag:function(e){if(e.type=="mousedown"){e.preventDefault()}if(c){return}c=true;h=_.getDragPoint(e);v=null;m=_.getElementPoint();y=_.getElementPoint();b=_.getPageScrollPoint();w=_.getPageScrollPoint();E=false;_.endTween();d=0;N.tick()},handler_moveDrag:function(e){if(!c){return}e.preventDefault();var t=N.tick();if(!t){return}d+=t;p=_.getDragPoint(e);var r=p.x-h.x;var o=p.y-h.y;var u=i.width();var a=i.height();var f=s.width();var l=s.height();if(!S){if(Math.sqrt(r*r+o*o)>=n.dragThreshold){if(Math.abs(r)>=Math.abs(o)){v=SwipeScroll.DIRECTION_HORIZONTAL;if(u<=f){E=true}}else{v=SwipeScroll.DIRECTION_VERTICAL;if(a<=l){E=true}}_.beginRender()}else{return}}if(v==SwipeScroll.DIRECTION_HORIZONTAL||n.bidirectional){if(!E){var g=n.overDrag*f;y.x=m.x+r;y.x=Math.max(Math.min(y.x,g),-(u-f)-g)}else{w.x=b.x+r}}if(v==SwipeScroll.DIRECTION_VERTICAL||n.bidirectional){if(!E){var g=n.overDrag*l;y.y=m.y+o;y.y=Math.max(Math.min(y.y,g),-(a-l)-g)}else{w.y=b.y+o}}},handler_endDrag:function(e){if(e.type=="mouseup"){e.preventDefault()}if(!_.endDrag()){return}if(S){if(!E){if(n.useMomentum){_.calcMomentum(m,y)}_.rangeElementPoint();if(n.useSnap){_.scrollToChild(_.getClosestChild(y))}else{_.beginTween(_.getElementPoint())}}else{if(n.useMomentum){_.calcMomentum(b,w)}_.rangePageScrollPoint();_.beginTween(_.getPageScrollPoint())}}},endDrag:function(){if(!c){return false}c=false;return true},beginRender:function(){if(S){return}S=true;C.tick();k=setInterval(_.handler_renderTimer,1e3/n.fps>>0)},handler_renderTimer:function(e){if(!S){return}var t=C.tick();if(!t){return}if(c){if(!E){_.setElementPoint(y)}else{_.setPageScrollPoint(w)}}else{if(!E){_.setElementPoint(_.doTween(y,t))}else{_.setPageScrollPoint(_.doTween(w,t))}}if(n.scrollbars){_.positionScrollbars()}},endRender:function(){if(!S){return}S=false;E=false;clearInterval(k);k=null},beginTween:function(t){x=t;T=0;if(!E){e(i).trigger(SwipeScroll.EVENT_CHANGING,{selectedChild:A,selectedIndex:O});if(n.cssAnimationClass){_.endRender();i.on("webkitTransitionEnd otransitionend transitionend",_.endTween);i.addClass(n.cssAnimationClass);_.setElementPoint(y)}}},doTween:function(e,t){var r={};T+=t;if(T<n.timing){r.x=x.x+n.scrollEasing(T,0,e.x-x.x,n.timing);r.y=x.y+n.scrollEasing(T,0,e.y-x.y,n.timing)}else{T=n.timing;r.x=e.x;r.y=e.y;_.endTween()}return r},endTween:function(e){x=null;T=n.timing;_.endRender();if(!E){if(n.cssAnimationClass){i.off("webkitTransitionEnd otransitionend transitionend",_.endTween);i.removeClass(n.cssAnimationClass)}if(e!==true){_.fireEventChanged()}}},isTweening:function(){return T>0&&T<n.timing},handler_resize:function(){if(L){clearTimeout(L)}L=setTimeout(function(){clearTimeout(L);if(n.scrollbars){_.sizeScrollbars()}if(n.useSnap){_.scrollToChild(A,false)}},1e3/n.fps>>0)},getDragPoint:function(e){var t=e;if(e.originalEvent){if(e.originalEvent.touches||e.originalEvent.changedTouches){t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]}}return{x:t.clientX,y:t.clientY}},calcMomentum:function(e,t){var r=t.x-e.x;var i=t.y-e.y;var s=Math.sqrt(r*r+i*i);var o=p.x-h.x;var u=p.y-h.y;var a=Math.sqrt(o*o+u*u);var f=Math.min(a*n.dragSpeedFactor/d,n.dragMaxSpeed)*n.timing;t.x+=r/s*f;t.y+=i/s*f;return t},getElementPoint:function(){return{x:parseInt(i.css("left")),y:parseInt(i.css("top"))}},setElementPoint:function(e){var t=e.x>>0;var n=e.y>>0;if(t!=g.x){i.css("left",t);g.x=t}if(n!=g.y){i.css("top",n);g.y=n}},rangeElementPoint:function(){y.x=Math.min(Math.max(y.x,s.width()-i.width()),0);y.y=Math.min(Math.max(y.y,s.height()-i.height()),0)},getPageScrollPoint:function(){return{x:-(window.pageXOffset||document.documentElement.scrollLeft),y:-(window.pageYOffset||document.documentElement.scrollTop)}},setPageScrollPoint:function(e){window.scrollTo(-e.x>>0,-e.y>>0)},rangePageScrollPoint:function(){w.x=Math.min(Math.max(w.x,e(window).width()-e(document).width()),0);w.y=Math.min(Math.max(w.y,e(window).height()-e(document).height()),0)},getClosestChild:function(t){var n=-1;var r=null;var i=o;var s=i.length;for(var u=0;u<s;u++){var a=e(i[u]);var f=_.getChildPoint(a);var l=t.x+f.x;var c=t.y+f.y;var h=Math.sqrt(l*l+c*c);if(n==-1||h<n){n=h;r=a}}return r},getChildPoint:function(e){var t=e.position();var n=t.left;var r=t.top;var o=i.width();var u=i.height();var a=s.width();var f=s.height();if(o>a){var l=e.width();if(Math.abs(n+l-o)<=1){n-=a-l}}if(u>f){var c=e.height();if(Math.abs(r+c-u)<=1){r-=f-c}}return{x:n,y:r}},fireEventChanged:function(){if(!M){return}e(i).trigger(SwipeScroll.EVENT_CHANGED,{selectedChild:A,selectedIndex:O});M=false}};_.initialize();_.activate();this.SwipeScroll={initialize:_.initialize,destroy:_.destroy,activate:_.activate,deactivate:_.deactivate,reset:_.reset,scrollToChild:_.scrollToChild,scrollToIndex:_.scrollToIndex,scrollPrevious:_.scrollPrevious,scrollNext:_.scrollNext,updateChildren:_.updateChildren,getSelectedChild:function(){return A},getSelectedIndex:function(){return O}};return this};e.fn.SwipeScroll.defaults=SwipeScroll.defaults})(jQuery)